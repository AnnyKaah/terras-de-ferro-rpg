<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öîÔ∏è Terras de Ferro ‚Äî RPG para Dois</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Placeholder para arquivos de √°udio. Voc√™ precisar√° criar/baixar estes arquivos. -->
    <!-- Ex: music_start.mp3, music_game.mp3, sfx_click.mp3, sfx_dice_roll.mp3, sfx_success.mp3, sfx_partial.mp3, sfx_fail.mp3, sfx_notification.mp3, sfx_damage.mp3, sfx_heal.mp3, sfx_level_up.mp3 -->
    <!-- Exemplo de como criar um arquivo de √°udio simples:
         - Use um editor de √°udio (Audacity) ou gerador online.
         - Para sfx_click: um "blip" curto.
         - Para sfx_dice_roll: um som de dados chacoalhando.
         - Para sfx_success/partial/fail: sons curtos que indiquem o resultado.
         - Para sfx_notification: um "ding" suave.
         - Para music_start/game: m√∫sicas ambiente que se encaixem no tema Dark Fantasy.
    -->
    <style>
        /* Estilos adicionais para o Invent√°rio */
        .supplies-display {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            justify-content: center;
        }
        .supply-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 100px;
        }
        .supply-value {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent, #e94560);
            margin: 0.5rem 0;
        }
        .inventory-list ul {
            list-style: none;
            padding: 0;
            text-align: left;
        }
        .inventory-list li {
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 0.5rem;
            padding: 0.8rem;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .inventory-list li > span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .empty-inv {
            font-style: italic;
            opacity: 0.6;
            text-align: center !important;
            justify-content: center;
        }
    </style>
    <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
</head>
<body>
    <!-- Overlay de Transi√ß√£o de Cena -->
    <div id="transition-overlay"></div>

    <!-- Tutorial Elements -->
   <div id="tutorial-overlay" class="tutorial-overlay" style="display: none;"></div>
    <div id="tutorial-tooltip" class="tutorial-tooltip" style="display: none;">
        <p id="tutorial-text">Texto do tutorial aqui.</p>
        <button id="tutorial-btn" class="btn-primary btn-small" onclick="closeTutorial()">Entendi</button>
    </div>

    <!-- Camada de N√©voa -->
    <div id="fog-overlay"></div>

    <!-- Notifica√ß√µes de Conquista -->
    <div id="achievement-notification-container"></div>

    <!-- Container de Notifica√ß√µes Gerais (Toasts) -->
    <div id="toast-container"></div>

    <!-- Indicador de Status da Sala -->
    <div id="room-status-indicator" class="room-status hidden">üë• Aguardando Jogadores...</div>

    <!-- Tela de In√≠cio -->
    <div id="start-screen" class="screen active">
        <div class="hero-bg">
            <div class="parallax-layer layer-1"></div> <!-- C√©u estrelado -->
            <div class="parallax-layer layer-2"></div> <!-- Montanhas distantes -->
            <div class="parallax-layer layer-3"></div> <!-- Montanhas pr√≥ximas -->
            <div class="parallax-layer layer-4"></div> <!-- N√©voa -->
        </div>
        <div class="start-container">
            <div class="title-glow">‚öîÔ∏è</div>
            <h1 class="main-title">Terras de Ferro</h1>
            <p class="subtitle">Um RPG cooperativo para dois jogadores</p>
            <button id="btn-continue" class="btn-primary" style="display: none;" onclick="continueGame()">Continuar Aventura</button>
            
            <!-- Controles Multiplayer -->
            <div class="lobby-controls">
                <button id="btn-host" class="btn-primary" onclick="hostGame()">üëë Criar Sala (Sou Jogador 1)</button>
                
                <div class="lobby-input-group">
                    <input type="text" id="join-id-input" class="lobby-input" placeholder="Cole o ID da Sala aqui">
                    <button id="btn-join" class="btn-secondary" onclick="joinGameUI()">Entrar</button>
                </div>
                
                <button class="btn-secondary" onclick="startOfflineGame()" style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">Jogar Offline (Solo)</button>
            </div>

            <button class="btn-secondary" onclick="showRules()">Como Jogar</button>
        </div>
    </div>

    <!-- Tela de Regras -->
    <div id="rules-screen" class="screen">
        <div class="rules-container">
            <h2>üé≤ Como Jogar</h2>
            <div class="rule-section">
                <h3>1. Rolar os Dados</h3>
                <p>Clique no bot√£o "Rolar Dados" quando precisar fazer uma a√ß√£o arriscada.</p>
                <p>O jogo rola automaticamente 1d6 (sua a√ß√£o) e 2d10 (o desafio).</p>
            </div>
            <div class="rule-section">
                <h3>2. Entender o Resultado</h3>
                <ul>
                    <li><strong>‚úÖ Sucesso Total:</strong> Deu tudo certo!</li>
                    <li><strong>üåì Sucesso Parcial:</strong> Deu certo, mas com custo.</li>
                    <li><strong>‚ùå Falha:</strong> Algo deu errado.</li>
                </ul>
            </div>
            <div class="rule-section">
                <h3>3. Escolher as Decis√µes</h3>
                <p>Voc√™s dois decidem juntos qual op√ß√£o seguir em cada cena.</p>
            </div>
            <button class="btn-primary" onclick="hideRules()">Entendi!</button>
        </div>
    </div>

    <!-- Tela de Sele√ß√£o de Personagens -->
    <div id="character-screen" class="screen">
        <div class="char-select-container">
            <h2>Escolham Seus Personagens</h2>
            
            <!-- Painel de Informa√ß√µes do Host (Movido para c√°) -->
            <div id="host-info" style="display: none; background: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid var(--accent);">
                <p style="color: #a0aabf; margin-bottom: 5px;">Envie este ID para o Jogador 2:</p>
                <div class="lobby-input-group" style="margin: 0 auto;">
                    <input type="text" id="room-id-display" class="lobby-input" readonly value="Gerando ID...">
                    <button id="btn-copy" class="btn-secondary" onclick="copyRoomId()">üìã Copiar</button>
                </div>
                <p id="connection-status" style="color: var(--warning); margin-top: 10px;">Aguardando conex√£o...</p>
            </div>

            <p class="char-subtitle">Cada jogador escolhe um personagem</p>
            
            <div class="characters-grid">
                <!-- Lyra -->
                <div class="character-card" data-char="lyra">
                    <div class="taken-overlay">
                        <span class="taken-text">OCUPADO</span>
                    </div>
                    <div class="selected-badge">‚úÖ SELECIONADO</div>
                    <div class="char-header lyra-theme">
                        <img src="assets/images/avatar_lyra.png" alt="Lyra" class="char-avatar">
                        <h3>Lyra</h3>
                        <p class="char-role">A Ca√ßadora</p>
                    </div>
                    <div class="char-body">
                        <p class="char-bio">"Silenciosa, observadora e mortal com um arco."</p>
                        <div class="char-stats">
                            <div class="stat-item" data-tooltip="Fogo: Agilidade, velocidade e combate agressivo.">
                                <span class="stat-label">üî• Fogo</span>
                                <span class="stat-value highlight">3 ‚≠ê</span>
                            </div>
                            <div class="stat-item" data-tooltip="Sombra: Furtividade, ast√∫cia e mentiras.">
                                <span class="stat-label">üåë Sombra</span>
                                <span class="stat-value">2</span>
                            </div>
                            <div class="stat-item" data-tooltip="Engenho: Percep√ß√£o, sobreviv√™ncia e conhecimento.">
                                <span class="stat-label">üîß Engenho</span>
                                <span class="stat-value">2</span>
                            </div>
                        </div>
                        <div class="char-special">
                            <strong>üéØ Arqueira:</strong> +1 ao atirar com arco
                        </div>
                    </div>
                    <button class="btn-select" onclick="chooseCharacter('lyra')">Selecionar</button>
                </div>

                <!-- Daren -->
                <div class="character-card" data-char="daren">
                    <div class="taken-overlay">
                        <span class="taken-text">OCUPADO</span>
                    </div>
                    <div class="selected-badge">‚úÖ SELECIONADO</div>
                    <div class="char-header daren-theme">
                        <img src="assets/images/avatar_daren.png" alt="Daren" class="char-avatar">
                        <h3>Daren</h3>
                        <p class="char-role">O Curandeiro</p>
                    </div>
                    <div class="char-body">
                        <p class="char-bio">"Emp√°tico, curioso e surpreendentemente corajoso."</p>
                        <div class="char-stats">
                            <div class="stat-item" data-tooltip="Cora√ß√£o: Coragem, for√ßa de vontade e empatia.">
                                <span class="stat-label">‚ù§Ô∏è Cora√ß√£o</span>
                                <span class="stat-value highlight">3 ‚≠ê</span>
                            </div>
                            <div class="stat-item" data-tooltip="Sombra: Furtividade, ast√∫cia e mentiras.">
                                <span class="stat-label">üåë Sombra</span>
                                <span class="stat-value">2</span>
                            </div>
                            <div class="stat-item" data-tooltip="Engenho: Percep√ß√£o, sobreviv√™ncia e conhecimento.">
                                <span class="stat-label">üîß Engenho</span>
                                <span class="stat-value">2</span>
                            </div>
                        </div>
                        <div class="char-special">
                            <strong>üåø Curandeiro:</strong> Cura 3 HP sem rolar (1x por sess√£o)
                        </div>
                    </div>
                    <button class="btn-select" onclick="chooseCharacter('daren')">Selecionar</button>
                </div>
            </div>

            <div id="selection-status" class="selection-status">Aguardando sele√ß√µes...</div>
            <button id="undo-selection" class="btn-secondary" style="display: none; margin: 10px auto;" onclick="undoCharacterSelection()">‚Ü©Ô∏è Desfazer Sele√ß√£o</button>
            <button id="confirm-chars" class="btn-primary" style="display: none;" disabled>Aguardando o outro jogador...</button>
        </div>
    </div>

    <!-- Tela de Game Over -->
    <div id="game-over-screen" class="screen">
        <div class="game-over-container">
            <div class="skull-icon">‚ò†Ô∏è</div>
            <h2>Fim da Linha</h2>
            <p>A escurid√£o consumiu ambos os her√≥is.</p>
            <button class="btn-primary" onclick="restartCurrentScene()">Tentar Novamente</button>
        </div>
    </div>

    <!-- Tela Principal do Jogo -->
    <div id="game-screen" class="screen">
        <div class="game-layout">
            <!-- Sidebar com status dos personagens -->
            <aside class="sidebar">
                <div class="party-info">
                    <h3>Sua Dupla</h3>
                    <div id="char1-status" class="char-status"></div>
                    <div id="char2-status" class="char-status"></div>
                    <div id="bond-display" class="bond-display"></div>
                </div>
                
                <div class="progress-section">
                    <h4>Progresso da Miss√£o</h4>
                    <div class="progress-bar-container">
                        <div id="progress-bar" class="progress-bar"></div>
                    </div>
                    <p id="progress-text">0/6 pontos</p>
                </div>

                <div class="controls">
                    <button class="btn-action" onclick="showLevelUpModal()">‚≠ê N√≠vel</button>
                    <button class="btn-action" onclick="showDiceRoller()">üé≤ Rolar Dados</button>
                    <button class="btn-action" onclick="showInventory()">üéí Invent√°rio</button>
                    <button class="btn-action" onclick="showRestModal()">‚õ∫ Descansar</button>
                    <button class="btn-action" onclick="showAchievements()">üèÜ Conquistas</button>
                    <button class="btn-action" onclick="showJournal()">üìú Di√°rio</button>
                    <button id="btn-mute" class="btn-action" onclick="toggleAudio()">üîä Som: On</button>
                    <button id="btn-special-ability" class="btn-action" style="display: none;" onclick="useSpecialAbility()">‚ú® Habilidade Especial</button>
                </div>
            </aside>

            <!-- √Årea principal do jogo -->
            <main class="main-content">
                <div id="scene-container" class="scene-container">
                    <!-- As cenas ser√£o carregadas aqui -->
                </div>

                <div id="decision-container" class="decision-container">
                    <!-- As decis√µes ser√£o carregadas aqui -->
                </div>

                <div id="log-container" class="log-container">
                    
                    <!-- Hist√≥rico de a√ß√µes -->
                </div>
                <div class="chat-input-container">
                    <button class="btn-oracle" onclick="rollOracle()">üîÆ Or√°culo</button>
                    <input type="text" id="chat-input" placeholder="Fale em personagem ou digite /rolar fogo..." onkeypress="handleChatKey(event)">
                    <button class="btn-primary btn-small" onclick="sendChatMessage()">Enviar</button>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de Level Up -->
    <div id="level-up-modal" class="modal">
        <div class="modal-content level-up-modal-content">
            <h3>‚≠ê N√≠vel Acima!</h3>
            <p style="text-align: center; color: #a0a0a0; margin-bottom: 20px;">Escolha uma melhoria para seu personagem.</p>
            
            <div id="level-up-options" class="level-up-options">
                <!-- Op√ß√µes geradas via JS -->
            </div>

            <button class="btn-close" onclick="closeLevelUpModal()">Fechar</button>
        </div>
    </div>

    <!-- Modal de Equipamento -->
    <div id="equip-modal" class="modal">
        <div class="modal-content equip-modal-content">
            <h3>‚öîÔ∏è Equipar Item</h3>
            <p id="equip-modal-text" style="text-align: center; color: #a0a0a0; margin-bottom: 20px;">Escolha um slot para equipar o item.</p>
            <div id="equip-slots" class="equip-slots"></div>
            <button class="btn-close" onclick="closeEquipModal()">Cancelar</button>
        </div>
    </div>

    <!-- Modal de Rolagem de Dados -->
    <div id="dice-modal" class="modal">
        <div class="modal-content dice-modal-content">
            <h3>üé≤ Rolar Dados</h3>
            <p id="dice-context">Quem est√° rolando?</p>
            
            <div class="dice-options">
                <button class="btn-dice" onclick="rollDice(1)">
                    <span id="char1-name">Jogador 1</span>
                </button>
                <button class="btn-dice" onclick="rollDice(2)">
                    <span id="char2-name">Jogador 2</span>
                </button>
            </div>

            <div class="bond-controls-modal">
                <button id="btn-use-bond" class="btn-secondary" onclick="useBondForRoll()">‚ù§Ô∏è Usar La√ßo (+1)</button>
                <span id="bond-count-modal">0/5</span>
            </div>

            <div id="dice-result" class="dice-result" style="display: none;">
                <div class="dice-display">
                    <div class="die-box action-die">
                        <span class="die-label">A√ß√£o (d6)</span>
                        <span id="d6-result" class="die-value">-</span>
                    </div>
                    <div class="operator">+</div>
                    <div class="die-box attr-die">
                        <span class="die-label">Atributo</span>
                        <span id="attr-result" class="die-value">-</span>
                    </div>
                    <div class="operator">=</div>
                    <div class="die-box total-die">
                        <span class="die-label">Total</span>
                        <span id="total-result" class="die-value">-</span>
                    </div>
                </div>

                <div class="vs">VS</div>

                <div class="dice-display">
                    <div class="die-box challenge-die">
                        <span class="die-label">Desafio 1</span>
                        <span id="d10-1-result" class="die-value">-</span>
                    </div>
                    <div class="die-box challenge-die">
                        <span class="die-label">Desafio 2</span>
                        <span id="d10-2-result" class="die-value">-</span>
                    </div>
                </div>

                <div id="dice-verdict" class="dice-verdict"></div>
            </div>

            <button class="btn-close" onclick="closeDiceModal()">Fechar</button>
        </div>
    </div>

    <!-- Modal de Invent√°rio -->
    <div id="inventory-modal" class="modal">
        <div class="modal-content inventory-modal-content">
            <h3>üéí Invent√°rio & Suprimentos</h3>
            
            <div class="supplies-display">
                <div class="supply-card">
                    <h4>Lyra</h4>
                    <span id="inv-supplies-1" class="supply-value">5/5</span>
                    <p>Suprimentos</p>
                </div>
                <div class="supply-card">
                    <h4>Daren</h4>
                    <span id="inv-supplies-2" class="supply-value">5/5</span>
                    <p>Suprimentos</p>
                </div>
            </div>

            <div class="inventory-list">
                <div class="inventory-columns">
                    <div class="inv-col">
                        <h4>üéí Lyra</h4>
                        <ul id="inv-list-1"></ul>
                    </div>
                    <div class="inv-col">
                        <h4>üéí Daren</h4>
                        <ul id="inv-list-2"></ul>
                    </div>
                </div>
            </div>

            <button class="btn-close" onclick="closeInventory()">Fechar</button>
        </div>
    </div>

    <!-- Modal de Descanso -->
    <div id="rest-modal" class="modal">
        <div class="modal-content rest-modal-content">
            <h3>‚õ∫ Acampamento</h3>
            <p style="text-align: center; color: #a0a0a0; margin-bottom: 20px;">Gastem suprimentos para recuperar for√ßas.</p>
            
            <div class="rest-options">
                <!-- Op√ß√µes geradas via JS -->
            </div>

            <button class="btn-close" onclick="closeRestModal()">Voltar</button>
        </div>
    </div>

    <!-- Modal de Conquistas -->
    <div id="achievements-modal" class="modal">
        <div class="modal-content achievements-modal-content">
            <h3>üèÜ Conquistas</h3>
            <div id="achievements-grid" class="achievements-grid">
                <!-- Gerado via JS -->
            </div>
            <button class="btn-close" onclick="closeAchievements()">Fechar</button>
        </div>
    </div>

    <!-- Modal de Di√°rio -->
    <div id="journal-modal" class="modal">
        <div class="modal-content journal-modal-content">
            <h3>üìú Di√°rio de Miss√£o</h3>
            <div id="journal-entries" class="journal-list">
                <!-- Gerado via JS -->
            </div>
            <button class="btn-close" onclick="closeJournal()">Fechar</button>
        </div>
    </div>

    <!-- Modal de Conex√£o Perdida -->
    <div id="connection-lost-modal" class="modal" style="z-index: 9999;">
        <div class="modal-content" style="text-align: center; border-color: var(--danger);">
            <div style="font-size: 4rem; margin-bottom: 10px;">üîå</div>
            <h3 style="color: var(--danger);">Conex√£o Perdida!</h3>
            <p>A conex√£o com o outro jogador caiu.</p>
            <p style="font-size: 0.9rem; color: #aaa; margin-bottom: 20px;">Aguarde ele reconectar ou tente entrar novamente.</p>
            
            <!-- Bot√£o apenas para o Cliente tentar reconectar se necess√°rio -->
            <button class="btn-primary" onclick="location.reload()">Recarregar e Tentar Novamente</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/audio.js"></script>
    <script src="js/game.js"></script>
    <script src="js/characters.js"></script>
    <script src="js/scenes.js"></script>
    <script src="js/dice.js"></script>
    <script src="js/multiplayer.js"></script>
</body>
</html>
